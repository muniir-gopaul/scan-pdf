import{u as k,Q as D}from"./use-quasar-DJZi0Trs.js";import{c as F,r as p,M as U,N as R,o as N,g as $,h as A,b as L,O,P as Q,e as j,R as M,p as T,S as K,T as H,B as w,C as V,D as y,H as f,U as E,I as q,V as W,W as X,X as Y,K as Z,Y as C,Z as z,Q as G,_ as J}from"./index-ClF83a6r.js";import{api as ee}from"./axios-BXmEB6z6.js";const te=F({name:"QForm",props:{autofocus:Boolean,noErrorFocus:Boolean,noResetFocus:Boolean,greedy:Boolean,onSubmit:Function},emits:["reset","validationSuccess","validationError"],setup(u,{slots:v,emit:i}){const g=$(),o=p(null);let r=0;const c=[];function b(e){const m=typeof e=="boolean"?e:u.noErrorFocus!==!0,_=++r,h=(t,n)=>{i(`validation${t===!0?"Success":"Error"}`,n)},B=t=>{const n=t.validate();return typeof n.then=="function"?n.then(d=>({valid:d,comp:t}),d=>({valid:!1,comp:t,err:d})):Promise.resolve({valid:n,comp:t})};return(u.greedy===!0?Promise.all(c.map(B)).then(t=>t.filter(n=>n.valid!==!0)):c.reduce((t,n)=>t.then(()=>B(n).then(d=>{if(d.valid===!1)return Promise.reject(d)})),Promise.resolve()).catch(t=>[t])).then(t=>{if(t===void 0||t.length===0)return _===r&&h(!0),!0;if(_===r){const{comp:n,err:d}=t[0];if(d!==void 0&&console.error(d),h(!1,n),m===!0){const I=t.find(({comp:P})=>typeof P.focus=="function"&&O(P.$)===!1);I!==void 0&&I.comp.focus()}}return!1})}function S(){r++,c.forEach(e=>{typeof e.resetValidation=="function"&&e.resetValidation()})}function l(e){e!==void 0&&Q(e);const m=r+1;b().then(_=>{m===r&&_===!0&&(u.onSubmit!==void 0?i("submit",e):e?.target!==void 0&&typeof e.target.submit=="function"&&e.target.submit())})}function a(e){e!==void 0&&Q(e),i("reset"),j(()=>{S(),u.autofocus===!0&&u.noResetFocus!==!0&&s()})}function s(){M(()=>{if(o.value===null)return;(o.value.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||o.value.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||o.value.querySelector("[autofocus], [data-autofocus]")||Array.prototype.find.call(o.value.querySelectorAll("[tabindex]"),m=>m.tabIndex!==-1))?.focus({preventScroll:!0})})}T(K,{bindComponent(e){c.push(e)},unbindComponent(e){const m=c.indexOf(e);m!==-1&&c.splice(m,1)}});let x=!1;return U(()=>{x=!0}),R(()=>{x===!0&&u.autofocus===!0&&s()}),N(()=>{u.autofocus===!0&&s()}),Object.assign(g.proxy,{validate:b,resetValidation:S,submit:l,reset:a,focus:s,getValidationComponents:()=>c}),()=>A("form",{class:"q-form",ref:o,onSubmit:l,onReset:a},L(v.default))}}),ae={key:0,class:"text-negative text-center q-mb-sm"},oe={class:"row justify-center"},se={__name:"LoginCard",setup(u){const v=p(""),i=p(""),g=p(""),o=p(""),r=p(!1),c=H(),b=k();async function S(){o.value="",r.value=!0;try{const l=await ee.post("/api/auth/login",{CompanyDB:v.value,UserName:i.value,Password:g.value});if(!l.data.success){o.value=l.data.message;return}const{B1SESSION:a,ROUTEID:s}=l.data.cookies,x=`${a}; ${s}`;localStorage.setItem("sapCookies",x),localStorage.setItem("sapSession",l.data.sessionId),localStorage.setItem("username",i.value),b.notify({type:"positive",message:"Login Successful"}),c.push("/parser")}catch(l){o.value=l.response?.data?.message||"Unable to connect to server"}finally{r.value=!1}}return(l,a)=>(V(),w(J,{class:"q-pa-lg",style:{"min-width":"350px"}},{default:y(()=>[f(E,null,{default:y(()=>[...a[3]||(a[3]=[q("div",{class:"text-h6 text-center"},"Login",-1)])]),_:1}),f(W),f(E,null,{default:y(()=>[f(te,{onSubmit:X(S,["prevent"]),class:"q-gutter-md"},{default:y(()=>[f(C,{filled:"",modelValue:v.value,"onUpdate:modelValue":a[0]||(a[0]=s=>v.value=s),label:"Company Database",dense:"",autofocus:""},null,8,["modelValue"]),f(C,{filled:"",modelValue:i.value,"onUpdate:modelValue":a[1]||(a[1]=s=>i.value=s),label:"Username",dense:""},null,8,["modelValue"]),f(C,{filled:"",modelValue:g.value,"onUpdate:modelValue":a[2]||(a[2]=s=>g.value=s),label:"Password",type:"password",dense:""},null,8,["modelValue"]),o.value?(V(),Y("div",ae,z(o.value),1)):Z("",!0),q("div",oe,[f(G,{label:"Login",type:"submit",color:"primary",loading:r.value},null,8,["loading"])])]),_:1})]),_:1})]),_:1}))}},ie={__name:"LoginPage",setup(u){return(v,i)=>(V(),w(D,{class:"flex flex-center"},{default:y(()=>[f(se)]),_:1}))}};export{ie as default};
